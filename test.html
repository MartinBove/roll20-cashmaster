<html>
<head>
<script type="text/javascript">

function cm_changemoney(startamount,addamount)
	{
		if (addamount !== null) {
		var currency=addamount.slice(-2);
		var amount2=-parseInt(addamount.substr(0,addamount.length-2));
		var origamount=startamount;
		var amount3=0;
		if (currency=="cp") amount3=amount2/100;
		if (currency=="sp") amount3=amount2/10;
		if (currency=="ep") amount3=amount2/2;
		if (currency=="gp") amount3=amount2;
		if (currency=="pp") amount3=amount2*10;
		if (startamount[0]*10+startamount[1]+startamount[2]/2+startamount[3]/10+startamount[4]/100>-amount3) 
		{
			startamount[4]+=amount3*100;		
			while (startamount[4]<0) {startamount[4]+=10;startamount[3]--;} //cp
			while (startamount[3]<0) {if (startamount[4]>10) {startamount[4]-=10;startamount[3]++} else {startamount[3]+=5;startamount[2]--;}} //sp
			while (startamount[2]<0) {if (startamount[3]>5) {startamount[3]-=5;  startamount[4]++} else {startamount[2]+=2;startamount[1]--;}}   //ep
			while (startamount[1]<0) {if (startamount[2]>2) {startamount[2]-=2;  startamount[1]++} else {startamount[1]+=10;startamount[0]--;}} //gp
			while (startamount[0]<0) {if (startamount[1]>10) {startamount[1]-=10;  startamount[0]++} else {startamount=origamount;return "ERROR: Not enough cash.";}} //pp
			return startamount;
		}
		else return "ERROR: Not enough cash.";
		}
	}


function cm_usd(total,usd=110)
	{
	var output="";	
	if (usd>0) output="<span style='display:inline;' title='Equals roughly "+(Math.round((total*usd)/5)*5)+" USD'>"+total+" gp</span>";
	else output=total;
	return output;
	}
	
	
var test1=[0,50,0,0,50];
var test2=["1cp","1pp","5gp","500pp","-1cp","1ep","77sp"];

for(i=0;i<test2.length;i++)
{
document.writeln("Taking <i>"+test2[i]+"</i> from <b>"+test1+"</b> => ");
document.writeln("<b>"+cm_changemoney(test1,test2[i])+"</b>");
document.writeln("/ "+cm_usd(test1[0]*10+test1[1]+test1[2]/2+test1[3]/10+test1[4]/100)+"");
document.writeln("<p>");
}



</script>
</head>
<body>

</body>
</html>